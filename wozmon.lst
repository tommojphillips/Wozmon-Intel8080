     1 			;  The WOZ Monitor for the Apple 1
     2 			;  Written by Steve Wozniak in 1976
     3
     4 			; Adapted instructions for the intel 8080
     5 			; Written by tommojphillips in 2025
     6
     7 			; Page 0 Variables
     8
     9      00 24	XAML            SET 0024H           ;  Last "opened" location Low
    10      00 25	XAMH            SET 0025H           ;  Last "opened" location High
    11      00 26	STL             SET 0026H           ;  Store address Low
    12      00 27	STH             SET 0027H           ;  Store address High
    13      00 28	LOW             SET 0028H           ;  Hex value parsing Low
    14      00 29	HIGH            SET 0029H           ;  Hex value parsing High
    15      00 2A	YSAV            SET 002AH           ;  Used to see if hex value is given
    16      00 2B	MODE            SET 002BH           ;  $00=XAM, $7F=STOR, $AE=BLOCK XAM
    17
    18 			; Other Variables
    19
    20      02 00	BUFFER          SET 0200H           ; Text Input Buffer, Goes up
    21      01 FE	STACK_TOP       SET 01FEH           ; Top of stack, Goes down
    22
    23      00 10	SIO_STATUS      SET 010H            ; 2SIO Status Input Port
    24      00 11	SIO_READ        SET 011H            ; 2SIO Read byte Input Port
    25      00 11	SIO_WRITE       SET 011H            ; 2SIO Write byte Output Port
    26
    27      00 0D	CR              SET 0DH
    28      00 0A	LF              SET 0AH
    29      00 1B	ESC             SET 01BH
    30
    31      D0 00	                ORG 0D000H
    32
    33 D000 31 FE 01	RESET:          LXI SP, STACK_TOP
    34 D003 01 7F 02	                LXI B, BUFFER + 07FH
    35
    36 D006 FE 5F	NOTCR:          CPI '_'
    37 D008 CA 25 D0	                JZ BACKSPACE
    38 D00B FE 1B	                CPI ESC
    39 D00D CA 14 D0	                JZ ESCAPE
    40 D010 0C		                INR C
    41 D011 F2 29 D0	                JP NEXTCHAR
    42
    43 D014 3E 5C	ESCAPE:         MVI A, 05CH
    44 D016 CD 4D D1	                CALL ECHO
    45 D019 3E 0D	GETLINE:        MVI A, CR
    46 D01B CD 4D D1	                CALL ECHO
    47 D01E 3E 0A	                MVI A, LF
    48 D020 CD 4D D1	                CALL ECHO
    49 D023 0E 01	                MVI C, 1
    50
    51 D025 0D		BACKSPACE:      DCR C
    52 D026 FA 19 D0	                JM GETLINE
    53
    54 D029 DB 10	NEXTCHAR:       IN SIO_STATUS
    55 D02B FE 02	                CPI 02H
    56 D02D CA 29 D0	                JZ NEXTCHAR
    57 D030 DB 11	                IN SIO_READ
    58 D032 02		                STAX B
    59 D033 CD 4D D1	                CALL ECHO
    60
    61 D036 FE 0D	                CPI CR
    62 D038 C2 06 D0	                JNZ NOTCR
    63
    64 D03B 3E 0A	                MVI A, LF
    65 D03D CD 4D D1	                CALL ECHO
    66
    67 D040 0E FF	                MVI C, 0FFH
    68 D042 3E 00	                MVI A, 0
    69 D044 5F		                MOV E, A
    70 D045 32 2B 00	SETMODE:        STA MODE
    71
    72 D048 0C		BLSKIP:         INR C
    73 D049 0A		NEXTITEM:       LDAX B
    74
    75 D04A FE 0D	                CPI CR
    76 D04C CA 19 D0	                JZ GETLINE
    77 			                
    78 D04F FE 2E	                CPI '.'
    79 D051 DA 48 D0	                JC BLSKIP
    80 D054 CA 45 D0	                JZ SETMODE
    81
    82 D057 FE 3A	                CPI ':'
    83 D059 CA 45 D0	                JZ SETMODE
    84
    85 D05C FE 52	                CPI 'R'
    86 D05E CA C6 D0	                JZ RUN
    87
    88 D061 7B		                MOV A, E
    89 D062 32 28 00	                STA LOW
    90 D065 32 29 00	                STA HIGH
    91 			                
    92 D068 79		                MOV A, C
    93 D069 32 2A 00	                STA YSAV
    94
    95 D06C 0A		NEXTHEX:        LDAX B
    96 D06D EE 30	                XRI 030H
    97 D06F FE 0A	                CPI 0AH
    98 D071 DA 7B D0	                JC DIG
    99 D074 C6 89	                ADI 089H
   100 D076 FE FA	                CPI 0FAH
   101 D078 DA 9E D0	                JC NOTHEX
   102 D07B 17		DIG:            RAL
   103 D07C 17		                RAL
   104 D07D 17		                RAL
   105 D07E 17		                RAL
   106 D07F E6 F0	                ANI 0F0H
   107
   108 D081 1E 04	                MVI E, 04H
   109 D083 37		HEXSHIFT:       STC
   110 D084 3F		                CMC
   111 D085 17		                RAL
   112 D086 F5		                PUSH PSW
   113 D087 3A 28 00	                LDA LOW
   114 D08A 17		                RAL
   115 D08B 32 28 00	                STA LOW
   116 D08E 3A 29 00	                LDA HIGH
   117 D091 17		                RAL
   118 D092 32 29 00	                STA HIGH
   119 D095 F1		                POP PSW
   120 D096 1D		                DCR E
   121 D097 C2 83 D0	                JNZ HEXSHIFT
   122
   123 D09A 0C		                INR C
   124 D09B C2 6C D0	                JNZ NEXTHEX
   125
   126 D09E 21 2A 00	NOTHEX:         LXI H, YSAV
   127 D0A1 79		                MOV A, C
   128 D0A2 BE		                CMP M
   129 D0A3 CA 14 D0	                JZ ESCAPE
   130 			                
   131 D0A6 3A 2B 00	                LDA MODE
   132 D0A9 FE 3A	                CPI ':'
   133 D0AB C2 CA D0	                JNZ NOTSTOR
   134 			                
   135 D0AE 3A 28 00	                LDA LOW
   136 			                
   137 D0B1 2A 26 00	                LHLD STL
   138 D0B4 16 00	                MVI D, 0
   139 D0B6 19		                DAD D
   140 D0B7 77		                MOV M, A
   141 			                
   142 D0B8 21 26 00	                LXI H, STL
   143 D0BB 34		                INR M
   144 			                
   145 D0BC C2 49 D0	                JNZ NEXTITEM
   146
   147 D0BF 21 27 00	                LXI H, STH
   148 D0C2 34		                INR M
   149
   150 D0C3 C3 49 D0	TONEXTITEM:     JMP NEXTITEM
   151
   152 D0C6 2A 24 00	RUN:            LHLD XAML
   153 D0C9 E9		                PCHL
   154
   155 D0CA FE 00	NOTSTOR:        CPI 0H
   156 D0CC C2 0E D1	                JNZ XAMNEXT
   157 			                
   158 D0CF 3A 28 00	SETADR:         LDA LOW
   159 D0D2 32 26 00	                STA STL
   160 D0D5 32 24 00	                STA XAML
   161 			                
   162 D0D8 3A 29 00	                LDA HIGH
   163 D0DB 32 27 00	                STA STH
   164 D0DE 32 25 00	                STA XAMH
   165 			               
   166 D0E1 C2 FF D0	NXTPRNT:        JNZ PRDATA
   167
   168 D0E4 3E 0D	                MVI A, CR
   169 D0E6 CD 4D D1	                CALL ECHO
   170 D0E9 3E 0A	                MVI A, LF
   171 D0EB CD 4D D1	                CALL ECHO
   172 			                
   173 D0EE 3A 25 00	                LDA XAMH
   174 D0F1 CD 37 D1	                CALL PRBYTE
   175 			                
   176 D0F4 3A 24 00	                LDA XAML
   177 D0F7 CD 37 D1	                CALL PRBYTE
   178 			                
   179 D0FA 3E 3A	                MVI A, ':'
   180 D0FC CD 4D D1	                CALL ECHO
   181
   182 D0FF 3E 20	PRDATA:         MVI A, ' '
   183 D101 CD 4D D1	                CALL ECHO
   184 			                
   185 D104 2A 24 00	                LHLD XAML
   186 D107 16 00	                MVI D, 0
   187 D109 19		                DAD D
   188 D10A 7E		                MOV A, M
   189 			                
   190 D10B CD 37 D1	                CALL PRBYTE
   191
   192 D10E 21 2B 00	XAMNEXT:        LXI H, MODE
   193 D111 36 00	                MVI M, 0
   194
   195 D113 3A 24 00	                LDA XAML
   196 D116 21 28 00	                LXI H, LOW
   197 D119 BE		                CMP M
   198 			                
   199 D11A 3A 25 00	                LDA XAMH
   200 D11D 21 29 00	                LXI H, HIGH
   201 D120 9E		                SBB M
   202 			                
   203 D121 D2 C3 D0	                JNC TONEXTITEM
   204 			                
   205 D124 21 24 00	                LXI H, XAML
   206 D127 34		                INR M
   207 			                
   208 D128 C2 2F D1	                JNZ MOD8CHK
   209 			                
   210 D12B 21 25 00	                LXI H, XAMH
   211 D12E 34		                INR M
   212
   213 D12F 3A 24 00	MOD8CHK:        LDA XAML
   214 D132 E6 07	                ANI 07H
   215 D134 C3 E1 D0	                JMP NXTPRNT
   216
   217 D137 F5		PRBYTE:         PUSH PSW          
   218 			                
   219 D138 1F		                RAR
   220 D139 1F		                RAR
   221 D13A 1F		                RAR
   222 D13B 1F		                RAR
   223 D13C E6 0F	                ANI 0FH
   224 			                
   225 D13E CD 42 D1	                CALL PRHEX
   226 D141 F1		                POP PSW
   227
   228 D142 E6 0F	PRHEX:          ANI 0FH
   229 D144 F6 30	                ORI 030H
   230 D146 FE 3A	                CPI 03AH
   231 D148 DA 4D D1	                JC ECHO
   232 D14B C6 07	                ADI 07H
   233 D14D D3 11	ECHO:           OUT SIO_WRITE
   234 D14F C9		                RET


*******************************************************************************
                                 Symbols table
*******************************************************************************

Names		Types	Values
-----		-----	------
XAML		SET	00024h
XAMH		SET	00025h
STL		SET	00026h
STH		SET	00027h
LOW		SET	00028h
HIGH		SET	00029h
YSAV		SET	0002Ah
MODE		SET	0002Bh
BUFFER		SET	00200h
STACK_TOP	SET	001FEh
SIO_STATUS	SET	00010h
SIO_READ	SET	00011h
SIO_WRITE	SET	00011h
CR		SET	0000Dh
LF		SET	0000Ah
ESC		SET	0001Bh
RESET		Label	0D000h
NOTCR		Label	0D006h
ESCAPE		Label	0D014h
GETLINE		Label	0D019h
BACKSPACE	Label	0D025h
NEXTCHAR	Label	0D029h
SETMODE		Label	0D045h
BLSKIP		Label	0D048h
NEXTITEM	Label	0D049h
NEXTHEX		Label	0D06Ch
DIG		Label	0D07Bh
HEXSHIFT	Label	0D083h
NOTHEX		Label	0D09Eh
TONEXTITEM	Label	0D0C3h
RUN		Label	0D0C6h
NOTSTOR		Label	0D0CAh
SETADR		Label	0D0CFh
NXTPRNT		Label	0D0E1h
PRDATA		Label	0D0FFh
XAMNEXT		Label	0D10Eh
MOD8CHK		Label	0D12Fh
PRBYTE		Label	0D137h
PRHEX		Label	0D142h
ECHO		Label	0D14Dh

Statistics
----------
"Name"	= 0
"EQU"	= 0
"SET"	= 16
Labels	= 24


